<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doorbin Waste - Contract Acceptance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-green: #2E8B57;
            --lime-green: #ADFF2F;
            --bg-dark: #121212;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
        }
        .accent-lime { color: var(--lime-green); }
        .bg-accent-lime { background-color: var(--lime-green); }
        .primary-green { color: var(--dark-green); }
        .bg-primary-green { background-color: var(--dark-green); }
        .hidden { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--dark-green); border-radius: 4px; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto">
        <!-- PAGE 1: SERVICE OVERVIEW & ACCEPTANCE -->
        <div id="page-1" class="fade-in">
            <header class="flex flex-col items-center mb-12 text-center">
                <img src="https://i.ibb.co/7NyScgsQ/doorbin-icon-new.png" alt="Doorbin Waste Logo" class="w-24 h-24 object-contain mb-4"/>
                <h1 class="text-3xl font-bold mb-1">Service Acceptance Protocol</h1>
                <p class="text-gray-400 font-medium">Doorbin Waste Professional Management Agreement</p>
            </header>

            <section class="mb-10 text-gray-300 leading-relaxed text-lg space-y-6">
                <p>This Professional Service Agreement governs the door-to-door waste collection and management services provided by Doorbin Waste LLC. Our specialized Valet Trash solution is meticulously designed to enhance multi-family residential properties and condominiums.</p>
                <p>Please review the specific details regarding property units, frequency, and pricing in the full 
                    <button id="link-to-terms" class="accent-lime font-bold hover:underline bg-transparent border-none p-0 cursor-pointer">Terms of Service</button> 
                    before final submission.
                </p>
            </section>

            <form id="acceptance-form" method="POST" action="https://n8n.doorbinwaste.com/webhook/consultar-cotizacion">
                <input type="hidden" name="airtable_record_id" id="hid-record-id">
                <input type="hidden" name="client" id="hid-client">
                <input type="hidden" name="property" id="hid-property">
                <input type="hidden" name="units" id="hid-units">
                <input type="hidden" name="service_frequency" id="hid-frequency">
                <input type="hidden" name="monthly_rate" id="hid-rate">

                <div class="space-y-4 mb-10 border-t border-gray-800 pt-10">
                    <label class="flex items-start space-x-3 cursor-pointer group">
                        <input type="checkbox" id="check-1" required class="mt-1 w-5 h-5 rounded border-gray-700 bg-gray-800 text-[#2E8B57] cursor-pointer">
                        <span class="text-sm text-gray-400 group-hover:text-white transition-colors">I have read and agree to the Doorbin Waste Master Service Agreement.</span>
                    </label>
                    <label class="flex items-start space-x-3 cursor-pointer group">
                        <input type="checkbox" id="check-2" required class="mt-1 w-5 h-5 rounded border-gray-700 bg-gray-800 text-[#2E8B57] cursor-pointer">
                        <span class="text-sm text-gray-400 group-hover:text-white transition-colors">I confirm that I have authority to bind the client to these terms.</span>
                    </label>
                </div>

                <div class="text-center">
                    <button type="submit" id="submit-btn" disabled class="w-full py-4 px-6 rounded-lg text-lg font-bold transition-all bg-gray-800 text-gray-600 cursor-not-allowed">
                        ACCEPT & CONTINUE
                    </button>
                    <p id="error-msg" class="text-xs text-red-500 mt-4 font-medium">You must check both boxes to continue.</p>
                </div>
            </form>
        </div>

        <!-- PAGE 2: FULL TERMS VIEW -->
        <div id="page-2" class="hidden fade-in">
            <header class="flex justify-between items-center mb-10 pb-6 border-b border-gray-800">
                <div class="flex items-center space-x-4">
                    <img src="https://i.ibb.co/7NyScgsQ/doorbin-icon-new.png" alt="Logo" class="w-12 h-12 object-contain"/>
                    <h2 class="text-xl font-bold">Detailed Terms of Service</h2>
                </div>
                <button id="back-to-1" class="accent-lime text-sm font-bold hover:underline">← Back to Overview</button>
            </header>
            <div id="terms-content" class="bg-[#1a1a1a] p-8 rounded-xl h-[60vh] overflow-y-auto custom-scrollbar text-sm text-gray-300 space-y-6 shadow-inner">
                <!-- Data loaded via JS -->
            </div>
        </div>

        <footer class="mt-16 text-center text-gray-600 text-xs">
            <p>© <span id="year"></span> Doorbin Waste Services LLC. All rights reserved.</p>
        </footer>
    </div>

    <script>
        const contractData = {
            client: 'Loading...',
            property: 'Loading...',
            units: '...',
            service_frequency: '...',
            monthly_rate: '...',
            summary: 'Loading service details...'
        };

        const ui = {
            page1: document.getElementById('page-1'),
            page2: document.getElementById('page-2'),
            check1: document.getElementById('check-1'),
            check2: document.getElementById('check-2'),
            submitBtn: document.getElementById('submit-btn'),
            errorMsg: document.getElementById('error-msg'),
            termsContent: document.getElementById('terms-content')
        };

        async function init() {
            document.getElementById('year').textContent = new Date().getFullYear();
            const params = new URLSearchParams(window.location.search);
            const recordId = params.get('id');
            
            if (recordId) {
                document.getElementById('hid-record-id').value = recordId;
                try {
                    const response = await fetch(`https://n8n.doorbinwaste.com/webhook/consultar-cotizacion?id=${recordId}`);
                    const data = await response.json();
                    
                    contractData.client = data.nombre_cliente || 'Not found';
                    contractData.property = data.propiedad || 'Not found';
                    contractData.units = data.unidades || '0';
                    contractData.service_frequency = data.frecuencia || 'Contact support';
                    contractData.monthly_rate = data.precio_mensual || '$0.00';
                    contractData.summary = data.detalle_servicio || 'Standard valet trash collection service.';

                    // Sync hidden fields for POST
                    document.getElementById('hid-client').value = contractData.client;
                    document.getElementById('hid-property').value = contractData.property;
                    document.getElementById('hid-units').value = contractData.units;
                    document.getElementById('hid-frequency').value = contractData.service_frequency;
                    document.getElementById('hid-rate').value = contractData.monthly_rate;

                } catch (err) {
                    console.error("Connection error with VPS:", err);
                }
            }
            generateTerms();
            ui.check1.addEventListener('change', validateForm);
            ui.check2.addEventListener('change', validateForm);
            document.getElementById('link-to-terms').addEventListener('click', () => switchPage(2));
            document.getElementById('back-to-1').addEventListener('click', () => switchPage(1));
        }

        function validateForm() {
            const isValid = ui.check1.checked && ui.check2.checked;
            ui.submitBtn.disabled = !isValid;
            if (isValid) {
                ui.submitBtn.classList.replace('bg-gray-800', 'bg-accent-lime');
                ui.submitBtn.classList.replace('text-gray-600', 'text-[#121212]');
                ui.submitBtn.classList.remove('cursor-not-allowed');
                ui.errorMsg.classList.add('hidden');
            } else {
                ui.submitBtn.classList.replace('bg-accent-lime', 'bg-gray-800');
                ui.submitBtn.classList.replace('text-[#121212]', 'text-gray-600');
                ui.submitBtn.classList.add('cursor-not-allowed');
                ui.errorMsg.classList.remove('hidden');
            }
        }

        function switchPage(p) { p === 1 ? (ui.page1.classList.remove('hidden'), ui.page2.classList.add('hidden')) : (ui.page1.classList.add('hidden'), ui.page2.classList.remove('hidden')); window.scrollTo(0,0); }

        function generateTerms() {
            ui.termsContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-white font-bold text-xl text-center border-b border-gray-800 pb-4 uppercase">SERVICE AGREEMENT</h2>
                    <p><strong>BETWEEN:</strong> Doorbin Waste LLC and <strong>${contractData.client}</strong>.</p>
                    <p><strong>SCOPE:</strong> Collection at <strong>${contractData.property}</strong> (${contractData.units} units).</p>
                    <p><strong>DETAILS:</strong> ${contractData.summary}</p>
                    <p><strong>RATE:</strong> The agreed monthly rate is <strong>${contractData.monthly_rate}</strong>.</p>
                    <div class="pt-8 border-t border-gray-800 text-xs text-gray-500 italic">Electronic acceptance constitutes a legally binding agreement.</div>
                </div>`;
        }
        init();
    </script>
</body>
</html>